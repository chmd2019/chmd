<?php
require_once "$root_icloud/Helpers/DateHelper.php";
require_once "$root_icloud/misarchivos/common/ControlMisArchivos.php";

//fecha actual
$objDateHelper = new DateHelper();
$objDateHelper->set_timezone();
$fecha_actual = date('m/d/Y');
$fecha_actual_impresa_script = "<script>var fecha = new Date('$fecha_actual');"
. "var options = {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };"
. "fecha = fecha.toLocaleDateString('es-MX', options);"
. "fecha = `\${fecha.charAt(0).toUpperCase()}\${fecha.slice(1).toLowerCase()}`;"
. "document.write(fecha)</script>";
//Fecha Actual
$time = time();
$arrayMeses = array('Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre');

$arrayDias = array( 'Domingo', 'Lunes', 'Martes',
'MiÃ©rcoles', 'Jueves', 'Viernes', 'Sabado');
$consulta = mysqli_fetch_array($consulta);
$familia = str_pad($consulta[2], 4, 0, STR_PAD_LEFT);
$id_usuario = $consulta['id'];
?>
<span>
  <h6><?php echo $fecha_actual_impresa_script; ?></h6>
  <div style="text-align: right;margin:1rem 1rem 0 0">
    <a class="waves-effect waves-light"
    href="<?php echo $redirect_uri; ?>">
    <!-- Atras -->
            <svg width="120px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
               viewBox="0 0 600 209.54" style="enable-background:new 0 0 600 209.54;" xml:space="preserve">
            <style type="text/css">
              .str0{fill:#6DC1EC;}
              .str1{fill:#0E497B;stroke:#0C4A7B;stroke-miterlimit:10;}
              .str2{fill-rule:evenodd;clip-rule:evenodd;fill:#0E497B;}
            </style>
            <path class="str0" d="M559.25,192.49H45.33c-16.68,0-30.33-13.65-30.33-30.33V50.42c0-16.68,13.65-30.33,30.33-30.33h513.92
              c16.68,0,30.33,13.65,30.33,30.33v111.74C589.58,178.84,575.93,192.49,559.25,192.49z"/>
            <g>
              <path class="str1" d="M228.72,128.74l23.47-52.37c1.26-2.8,3.52-4.51,6.68-4.51h0.54c3.16,0,5.33,1.72,6.59,4.51l23.47,52.37
                c0.45,0.81,0.63,1.62,0.63,2.35c0,2.98-2.26,5.33-5.24,5.33c-2.62,0-4.42-1.53-5.42-3.88l-5.15-11.83h-30.7l-5.33,12.19
                c-0.9,2.26-2.8,3.52-5.15,3.52c-2.89,0-5.15-2.26-5.15-5.15C228,130.45,228.27,129.64,228.72,128.74z M270.07,110.86l-11.11-25.55
                l-11.1,25.55H270.07z"/>
              <path class="str1" d="M313.14,83.05h-15.35c-2.89,0-5.15-2.35-5.15-5.15s2.26-5.15,5.15-5.15h41.98c2.8,0,5.06,2.35,5.06,5.15
                s-2.26,5.15-5.06,5.15h-15.44v47.85c0,3.07-2.53,5.51-5.6,5.51c-3.07,0-5.6-2.44-5.6-5.51V83.05z"/>
              <path class="str1" d="M351.6,78.36c0-3.16,2.44-5.6,5.6-5.6h22.57c7.95,0,14.17,2.35,18.24,6.32c3.34,3.43,5.24,8.12,5.24,13.63
                v0.18c0,10.11-5.87,16.25-14.36,18.87l12.1,15.26c1.08,1.35,1.81,2.53,1.81,4.24c0,3.07-2.62,5.15-5.33,5.15
                c-2.53,0-4.15-1.17-5.42-2.89l-15.35-19.59h-13.99v16.97c0,3.07-2.44,5.51-5.51,5.51c-3.16,0-5.6-2.44-5.6-5.51V78.36z
                 M378.96,104.09c7.95,0,13-4.15,13-10.56v-0.18c0-6.77-4.88-10.47-13.09-10.47h-16.16v21.22H378.96z"/>
              <path class="str1" d="M408.75,128.74l23.47-52.37c1.26-2.8,3.52-4.51,6.68-4.51h0.54c3.16,0,5.33,1.72,6.59,4.51l23.47,52.37
                c0.45,0.81,0.63,1.62,0.63,2.35c0,2.98-2.26,5.33-5.24,5.33c-2.62,0-4.42-1.53-5.42-3.88l-5.15-11.83h-30.7l-5.33,12.19
                c-0.9,2.26-2.8,3.52-5.15,3.52c-2.89,0-5.15-2.26-5.15-5.15C408.03,130.45,408.3,129.64,408.75,128.74z M450.1,110.86L439,85.31
                l-11.1,25.55H450.1z M436.02,65.18c0-0.63,0.36-1.44,0.72-1.99l5.15-7.95c0.99-1.62,2.44-2.62,4.33-2.62c2.89,0,6.5,1.81,6.5,3.52
                c0,0.99-0.63,1.9-1.53,2.71l-6.05,5.78c-2.17,1.99-3.88,2.44-6.41,2.44C437.19,67.07,436.02,66.35,436.02,65.18z"/>
              <path class="str1" d="M476.01,128.92c-1.26-0.9-2.17-2.44-2.17-4.24c0-2.89,2.35-5.15,5.24-5.15c1.54,0,2.53,0.45,3.25,0.99
                c5.24,4.15,10.83,6.5,17.7,6.5c6.86,0,11.2-3.25,11.2-7.95v-0.18c0-4.51-2.53-6.95-14.26-9.66c-13.45-3.25-21.04-7.22-21.04-18.87
                v-0.18c0-10.83,9.03-18.33,21.58-18.33c7.95,0,14.36,2.08,20.04,5.87c1.26,0.72,2.44,2.26,2.44,4.42c0,2.89-2.35,5.15-5.24,5.15
                c-1.08,0-1.99-0.27-2.89-0.81c-4.88-3.16-9.57-4.79-14.54-4.79c-6.5,0-10.29,3.34-10.29,7.49v0.18c0,4.88,2.89,7.04,15.08,9.93
                c13.36,3.25,20.22,8.04,20.22,18.51v0.18c0,11.83-9.3,18.87-22.57,18.87C491.18,136.86,483.05,134.15,476.01,128.92z"/>
            </g>
            <g>
              <path class="str2" d="M81.84,94.54h97.68c14.9,0,14.9,23.73,0,23.73H81.84l26.49,27.04c11.04,11.04-5.52,27.59-16.56,16.56
                l-47.46-46.91c-4.41-4.97-4.41-12.69,0-17.11l47.46-46.91c11.04-11.59,27.59,5.52,16.56,16.56L81.84,94.54z"/>
            </g>
            </svg>
  </a>
  <!--
  <a class="waves-effect waves-light btn red" href="#!" onclick="logout()">
    <i class="material-icons left">lock</i>Salir
  </a>
-->
</div>
</span>
<br>
<?php
$control_archivos= new ControlArchivos();
$lista_archivos = $control_archivos->listado_archivos($correo);
$contador = mysqli_num_rows($lista_archivos);

//padres
$padres = $control_archivos->get_padres($familia, $correo);
while($padre = mysqli_fetch_array($padres)){
  $tipo= $padre['responsable'];
  if ($tipo=='PADRE'){
    //papa
    $papa = $padre['nombre'];
  }else if($tipo=='MADRE'){
    //mama
    $mama = $padre['nombre'];
  }
}
//conseguir los Hijos
$hijos = $control_archivos->listado_hijos($familia);

//archivos Autorizados por el Usuario
$lista_archivos_autorizados = $control_archivos->listado_archivos_autorizados($familia);
$array_archivos_autorizados = array();
while ($row = mysqli_fetch_array($lista_archivos_autorizados)){
    array_push($array_archivos_autorizados, array("idarchivo"=> $row['idarchivo'] , "estatus" => $row['estatus'] ) );
}
if ($contador==0){
  ?>
  <br>
  <span class="badge blue c-blanco col s12">Sin Archivos para mostrar</span>
  <?php
}
else{
  ?>
  <table id="gradient-style" summary="Meeting Results">
    <thead class="b-azul white-text">
      <th  width="10%" ></th>
      <th>Nombre</th>
      <th>Estatus</th>
      <th>Descargar</th>
    </thead>
    <tbody>
      <?php
      while ($archivo= mysqli_fetch_array($lista_archivos)){
        $id = $archivo['idarchivo'];
        $nombre = $archivo['nombre'];
        $link= $archivo['link'];
        $modal = $archivo['modal'];
        //encontrar archivo
        $encontrado = false;
        $id_encontrado ='';
        $estatus_encontrado='';
        foreach ($array_archivos_autorizados as $archivo_autorizado) {
          if($archivo_autorizado['idarchivo'] == $id ){
            $encontrado = true;
            $id_encontrado = $archivo_autorizado['idarchivo'];
            $estatus_encontrado= $archivo_autorizado['estatus'];
          }
        }
        //encontrado
        if($encontrado){
          //Estatus
          $color_badge = "#EF4545";
          $status_detalle = "Error";
          switch ($estatus_encontrado) {
            case 2:
            $status_detalle = "Autorizado";
            $color_badge = "#77AF65";
            break;
            case 3:
            $color_badge = "#EF4545";
            $status_detalle = "Declinado";
            break;
          }
        }else{
          $status_detalle = "Pendiente";
          $color_badge = "#F6871F";
        }
        ?>
        <tr>
          <td width="10%"><img src="../images/file_pdf.png" alt="Doc" width="100%"> </td>
          <td><?=$nombre?></td>
            <td>
              <span class="chip white-text" style="font-size: .9rem;padding: 0px 3px;background-color: <?php echo $color_badge; ?>"><?php echo $status_detalle; ?>
              <!-- <span class="<?=$badge?>"><?=$status_detalle?></span> -->
            </td>
          <td>
            <?php
                if(!$encontrado){
                  include "$modal" ;
                }else{
                  $existe_enlace=false;
                  if ($link!=null){
                    #existe enlace de descarga
                    $existe_enlace=true;
                    include "$modal";
                  }else{
                    #No existe enlace de descarga
                    $existe_enlace=false;
                    include "$modal";
                  }

                  /*if($link!=null){
                    ?>
                    <a class="waves-effect waves-light modal-trigger" href="<?=$link?>" target="_blank">
                      <svg width="38px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                      	 viewBox="0 0 600 600" style="enable-background:new 0 0 600 600;" xml:space="preserve">
                      <style type="text/css">
                      	.stp0{fill:#77AF65;}
                      	.stp1{fill:#FFFFFF;}
                      	.stp2{fill:#0E497B;}
                      	.stp3{fill:#0E497B;stroke:#0E497B;stroke-miterlimit:10;}
                      </style>
                      <circle class="stp0" cx="2258.96" cy="257.69" r="246.41"/>
                      <g transform="matrix(0.19470664,0,0,0.19470664,0.15516101,0.15510016)">
                      	<path class="stp1" d="M12125.69,736.46c22.52,0,40.79-18.26,40.79-40.79v-128.7c0-49.18-39.99-89.2-89.16-89.2h-862.88
                      		c-10.82,0-21.19,4.3-28.84,11.95l-337.89,337.89c-7.65,7.65-11.95,18.02-11.95,28.84v1221.98c0,49.19,40.02,89.21,89.21,89.21
                      		h1152.35c49.17,0,89.16-40.02,89.16-89.2v-622.75c0-22.52-18.26-40.79-40.78-40.79c-22.52,0-40.79,18.26-40.79,40.79v622.75
                      		c0,4.2-3.4,7.63-7.58,7.63h-1152.36c-4.21,0-7.63-3.42-7.63-7.63V897.24h248.73c49.17,0,89.17-40,89.17-89.17V559.35h822.09
                      		c4.18,0,7.58,3.42,7.58,7.63v128.7C12084.9,718.2,12103.16,736.46,12125.69,736.46z M11173.65,808.07c0,4.19-3.41,7.59-7.59,7.59
                      		h-191.03l198.62-198.62V808.07z"/>
                      	<path class="stp1" d="M12439.66,809.13l-47.99-47.99c-53.81-53.81-141.37-53.8-195.19,0l-380.96,380.95h-660.78
                      		c-22.53,0-40.79,18.26-40.79,40.79c0,22.53,18.26,40.79,40.79,40.79h579.2l-245.49,245.49h-333.71
                      		c-22.53,0-40.79,18.26-40.79,40.79s18.26,40.79,40.79,40.79h252.13l-0.66,0.66c-4.98,4.98-8.58,11.15-10.46,17.93l-63,226.9
                      		h-178.02c-22.53,0-40.79,18.26-40.79,40.79s18.26,40.79,40.79,40.79h209.03c0,0,8.94-1.01,10.25-1.35
                      		c0.21-0.06,257.43-71.43,257.43-71.43c6.78-1.88,12.96-5.49,17.93-10.46l790.27-790.26
                      		C12493.47,950.5,12493.47,862.94,12439.66,809.13z M11422.38,1778.41l33.29-119.89l86.61,86.61L11422.38,1778.41z
                      		 M11620.56,1708.04l-127.8-127.8l652.34-652.34l127.8,127.8L11620.56,1708.04z M12381.98,946.62l-51.39,51.39l-127.8-127.8
                      		l51.39-51.39c22.01-22.01,57.82-22,79.81,0l47.99,47.99C12403.98,888.82,12403.98,924.62,12381.98,946.62z"/>
                      </g>
                      <text transform="matrix(1 0 0 1 2131.6074 583.7578)" class="stp3" style="font-family:'GothamRounded-Medium'; font-size:70.4995px; letter-spacing:-3;">editar</text>
                      <circle class="stp2" cx="300" cy="257.69" r="246.41"/>
                      <g>
                      	<path class="stp3" d="M89.35,538.78c0-2.47,1.9-4.37,4.37-4.37h14.03c15.51,0,26.22,10.64,26.22,24.53v0.14
                      		c0,13.89-10.72,24.67-26.22,24.67H93.72c-2.47,0-4.37-1.9-4.37-4.37V538.78z M107.75,575.86c10.36,0,17.13-6.98,17.13-16.64v-0.14
                      		c0-9.66-6.77-16.78-17.13-16.78h-9.73v33.56H107.75z"/>
                      	<path class="stp3" d="M140.95,579.39v-40.61c0-2.47,1.9-4.37,4.37-4.37h28.69c2.11,0,3.88,1.76,3.88,3.88
                      		c0,2.19-1.76,3.88-3.88,3.88h-24.39V555h21.22c2.12,0,3.88,1.76,3.88,3.95c0,2.12-1.76,3.81-3.88,3.81h-21.22V576h24.74
                      		c2.11,0,3.88,1.76,3.88,3.88c0,2.19-1.76,3.88-3.88,3.88h-29.04C142.86,583.76,140.95,581.85,140.95,579.39z"/>
                      	<path class="stp3" d="M183.4,578.26c-0.99-0.7-1.69-1.9-1.69-3.31c0-2.26,1.83-4.02,4.09-4.02c1.2,0,1.97,0.35,2.54,0.78
                      		c4.09,3.24,8.46,5.08,13.82,5.08c5.36,0,8.74-2.54,8.74-6.2v-0.14c0-3.53-1.97-5.43-11.14-7.54c-10.5-2.54-16.43-5.64-16.43-14.73
                      		v-0.14c0-8.46,7.05-14.31,16.85-14.31c6.2,0,11.21,1.62,15.65,4.58c0.99,0.56,1.9,1.76,1.9,3.45c0,2.26-1.83,4.02-4.09,4.02
                      		c-0.85,0-1.55-0.21-2.26-0.63c-3.81-2.47-7.47-3.74-11.35-3.74c-5.08,0-8.04,2.61-8.04,5.85v0.14c0,3.81,2.26,5.5,11.77,7.75
                      		c10.43,2.54,15.79,6.27,15.79,14.45v0.14c0,9.23-7.26,14.73-17.62,14.73C195.24,584.46,188.89,582.35,183.4,578.26z"/>
                      	<path class="stp3" d="M224.07,559.23v-0.14c0-14.03,10.5-25.52,25.45-25.52c7.61,0,12.62,2.26,16.92,5.57
                      		c0.92,0.71,1.69,1.9,1.69,3.45c0,2.4-1.9,4.23-4.3,4.23c-1.2,0-2.04-0.42-2.61-0.85c-3.38-2.75-7.05-4.44-11.77-4.44
                      		c-9.38,0-16.29,7.75-16.29,17.41v0.14c0,9.66,6.84,17.48,16.29,17.48c5.22,0,8.74-1.69,12.34-4.72c0.63-0.56,1.55-0.99,2.61-0.99
                      		c2.19,0,4.09,1.83,4.09,4.02c0,1.34-0.63,2.4-1.41,3.1c-4.65,4.09-9.94,6.63-17.91,6.63C234.79,584.6,224.07,573.39,224.07,559.23z
                      		"/>
                      	<path class="stp3" d="M271.94,578.12l18.33-40.89c0.99-2.19,2.75-3.52,5.22-3.52h0.42c2.47,0,4.16,1.34,5.15,3.52l18.33,40.89
                      		c0.35,0.63,0.49,1.27,0.49,1.83c0,2.33-1.76,4.16-4.09,4.16c-2.04,0-3.45-1.2-4.23-3.03l-4.02-9.24h-23.97l-4.16,9.52
                      		c-0.71,1.76-2.19,2.75-4.02,2.75c-2.26,0-4.02-1.76-4.02-4.02C271.38,579.46,271.59,578.82,271.94,578.12z M304.23,564.16
                      		l-8.67-19.95l-8.67,19.95H304.23z"/>
                      	<path class="stp3" d="M325.73,538.78c0-2.47,1.9-4.37,4.37-4.37h17.62c6.2,0,11.07,1.83,14.24,4.93c2.61,2.68,4.09,6.34,4.09,10.64
                      		v0.14c0,7.9-4.58,12.69-11.21,14.73l9.45,11.91c0.85,1.06,1.41,1.97,1.41,3.31c0,2.4-2.04,4.02-4.16,4.02
                      		c-1.97,0-3.24-0.92-4.23-2.26l-11.98-15.3H334.4v13.25c0,2.4-1.9,4.3-4.3,4.3c-2.47,0-4.37-1.9-4.37-4.3V538.78z M347.09,558.87
                      		c6.2,0,10.15-3.24,10.15-8.25v-0.14c0-5.29-3.81-8.18-10.22-8.18H334.4v16.57H347.09z"/>
                      	<path class="stp3" d="M370.99,559.23v-0.14c0-13.82,10.57-25.52,25.45-25.52c7.4,0,12.34,1.76,16.85,5.01
                      		c0.85,0.63,1.76,1.83,1.76,3.52c0,2.33-1.9,4.3-4.3,4.3c-1.13,0-1.97-0.49-2.68-0.99c-3.17-2.33-6.63-3.88-11.98-3.88
                      		c-9.09,0-16,7.97-16,17.41v0.14c0,10.15,6.7,17.62,16.78,17.62c4.65,0,8.88-1.48,11.91-3.74v-9.23h-9.73
                      		c-2.12,0-3.88-1.62-3.88-3.74c0-2.12,1.76-3.81,3.88-3.81h13.75c2.47,0,4.37,1.9,4.37,4.37v13.18c0,2.47-0.99,4.23-3.03,5.5
                      		c-4.23,2.82-10.15,5.36-17.55,5.36C381.14,584.6,370.99,573.61,370.99,559.23z"/>
                      	<path class="stp3" d="M422.1,578.12l18.33-40.89c0.99-2.19,2.75-3.52,5.22-3.52h0.42c2.47,0,4.16,1.34,5.15,3.52l18.33,40.89
                      		c0.35,0.63,0.49,1.27,0.49,1.83c0,2.33-1.76,4.16-4.09,4.16c-2.04,0-3.45-1.2-4.23-3.03l-4.02-9.24h-23.97l-4.16,9.52
                      		c-0.71,1.76-2.19,2.75-4.02,2.75c-2.26,0-4.02-1.76-4.02-4.02C421.54,579.46,421.75,578.82,422.1,578.12z M454.39,564.16
                      		l-8.67-19.95l-8.67,19.95H454.39z"/>
                      	<path class="stp3" d="M475.9,538.78c0-2.47,1.9-4.37,4.37-4.37h17.62c6.2,0,11.07,1.83,14.24,4.93c2.61,2.68,4.09,6.34,4.09,10.64
                      		v0.14c0,7.9-4.58,12.69-11.21,14.73l9.45,11.91c0.85,1.06,1.41,1.97,1.41,3.31c0,2.4-2.04,4.02-4.16,4.02
                      		c-1.97,0-3.24-0.92-4.23-2.26l-11.98-15.3h-10.93v13.25c0,2.4-1.9,4.3-4.3,4.3c-2.47,0-4.37-1.9-4.37-4.3V538.78z M497.26,558.87
                      		c6.2,0,10.15-3.24,10.15-8.25v-0.14c0-5.29-3.81-8.18-10.22-8.18h-12.62v16.57H497.26z"/>
                      </g>
                      <g>
                      	<path class="stp1" d="M195.16,245.47c-7.59-7.59-7.59-19.94,0-27.53c7.59-7.59,19.94-7.59,27.53,0l57.82,57.86V95.05
                      		c0-10.75,8.72-19.47,19.47-19.47c10.75,0,19.47,8.72,19.47,19.47v180.83l57.98-57.94c7.59-7.55,19.9-7.52,27.45,0.08
                      		c7.55,7.59,7.52,19.9-0.08,27.45l-91.04,91.08c-7.59,7.59-19.94,7.59-27.53,0C286.24,336.55,195.16,245.47,195.16,245.47z"/>
                      	<path class="stp1" d="M213.12,413.07c-10.75,0-19.47-8.72-19.47-19.47c0-10.75,8.72-19.47,19.47-19.47h173.86
                      		c10.75,0,19.47,8.72,19.47,19.47c0,10.75-8.72,19.47-19.47,19.47C386.98,413.07,213.12,413.07,213.12,413.07z"/>
                      </g>
                      </svg>
                    <!--
                    <i class="material-icons">file_download</i>
                    -->
                    </a>
                    <?php
                  }*/
                }
                ?>
          </td>
        </tr>
        <?php
      }
      ?>
    </tbody>
  </table>
  <?php
}
?>
